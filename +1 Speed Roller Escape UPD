local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/WhoGodsyoure/Home/refs/heads/main/Neko.lua"))()
local ThemeManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/WhoGodsyoure/Home/refs/heads/main/ThemeManager.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/WhoGodsyoure/Home/refs/heads/main/SaveManager.lua"))()

local Window = Library:CreateWindow({
    Title = "ArchiveXNova",
    Footer = "+1 Speed Roller Escape UPD | YouTube: ArchiveXNova",
    Icon = 85025739024001,
    NotifySide = "Right",
    ShowCustomCursor = true,
    Center = true,
    AutoShow = true,
})

local Tabs = {
    Main = Window:AddTab("Main"),
    ["UI Settings"] = Window:AddTab("Settings")
}

local Group = Tabs.Main:AddLeftGroupbox("Win")

local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local RunService = game:GetService("RunService")

local TARGET_CF = CFrame.new(4324.649, 124.595, -41.384)

local looping = false
local loopTask

local delays = {
    ["Normal"] = 0.4,
    ["Fast"] = 0.2,
    ["Super Fast"] = 0,
    ["Normal Loop"] = 0.4,
    ["Fast Loop"] = 0.15,
    ["Safe Loop"] = 0.6,
    ["Safe Mode (higher delay)"] = 0.8,
    ["Light Mode"] = 0.5,
    ["Normal Mode"] = 0.3,
    ["AFK Mode"] = 1
}

local function getHRP()
    local char = Player.Character or Player.CharacterAdded:Wait()
    return char:WaitForChild("HumanoidRootPart")
end

local function teleport(delayTime)
    local hrp = getHRP()
    hrp.CFrame = TARGET_CF
    if delayTime == 0 then
        RunService.Heartbeat:Wait()
    else
        task.wait(delayTime)
    end
end

local function startLoop(delayTime, duration)
    looping = true
    loopTask = task.spawn(function()
        local startTime = os.clock()
        while looping do
            teleport(delayTime)
            if duration and os.clock() - startTime >= duration then
                looping = false
            end
        end
    end)
end

local function stopAll()
    looping = false
end

Group:AddDropdown("ModeDropdown", {
    Values = {
        "One-Time: Normal",
        "One-Time: Fast",
        "One-Time: Super Fast",

        "Loop: Normal Loop",
        "Loop: Fast Loop",
        "Loop: Safe Loop",
        "Stop Loop",

        "Time Mode: Run for 30 seconds",
        "Time Mode: Run for 1 minute",

        "Stability: Safe Mode (higher delay)",

        "Performance: Light Mode",
        "Performance: Normal Mode",

        "AFK / Farm: AFK Mode",

        "Sistem: Stop All"
    },
    Default = 1,
    Multi = false,
    Text = "Mode",
    Callback = function(Value)
        stopAll()

        if Value == "Stop Loop" or Value == "Sistem: Stop All" then
            return
        end

        if Value:find("One-Time") then
            local mode = Value:match("One%-Time:%s(.+)")
            teleport(delays[mode] or 0.3)
            return
        end

        if Value:find("Loop:") then
            local mode = Value:match("Loop:%s(.+)")
            startLoop(delays[mode] or 0.3)
            return
        end

        if Value == "Time Mode: Run for 30 seconds" then
            startLoop(0.3, 30)
            return
        end

        if Value == "Time Mode: Run for 1 minute" then
            startLoop(0.3, 60)
            return
        end

        if Value:find("Stability:") or Value:find("Performance:") or Value:find("AFK") then
            local mode = Value:match(":%s(.+)")
            startLoop(delays[mode] or 0.4)
        end
    end
})

local Group = Tabs.Main:AddLeftGroupbox("Rebirth")

local RunService = game:GetService("RunService")
local Event = game:GetService("ReplicatedStorage").Events.Rebirth

local loopConn

Group:AddDropdown("ModeDropdown", {
    Values = {
        "Normal (Once)",
        "Loop",
        "Stop Loop"
    },
    Default = 1,
    Multi = false,
    Text = "Mode",
    Callback = function(Value)
        if loopConn then
            loopConn:Disconnect()
            loopConn = nil
        end

        if Value == "Normal (Once)" then
            Event:FireServer()

        elseif Value == "Loop" then
            loopConn = RunService.Heartbeat:Connect(function()
                Event:FireServer()
                task.wait(0.2)
            end)

        elseif Value == "Stop Loop" then
            return
        end
    end
})

local UIGroup = Tabs["UI Settings"]

ThemeManager:SetLibrary(Library)
SaveManager:SetLibrary(Library)

SaveManager:IgnoreThemeSettings()
SaveManager:SetFolder("ArchiveXNova")
SaveManager:BuildConfigSection(Tabs["UI Settings"])
ThemeManager:ApplyToTab(Tabs["UI Settings"])
